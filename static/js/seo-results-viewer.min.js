// SEO Results Viewer - Minimal Version
(function(){const config={colors:{primary:'#1e7d88',secondary:'#3b82f6',success:'#10b981',warning:'#f59e0b',danger:'#ef4444',info:'#6366f1'}};let initialized=false;document.addEventListener('DOMContentLoaded',function(){if(typeof Chart!=='undefined'){initViewer();}else{const script=document.createElement('script');script.src='https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';script.onload=initViewer;script.onerror=initViewerWithFallbacks;document.head.appendChild(script);}});function initViewer(){if(initialized)return;initialized=true;let container=document.getElementById('visualization-container');if(!container){const tabContent=document.querySelector('.tab-content');if(tabContent){container=document.createElement('div');container.id='visualization-container';container.className='space-y-6 mt-6';tabContent.insertBefore(container,tabContent.firstChild);}}const data=loadResultData();if(!data||!container)return;createSummaryStats(data,container);createCharts(data,container);setupFiltering(data);}function initViewerWithFallbacks(){initViewer();}function loadResultData(){try{const dataScript=document.getElementById('seo-results-data');if(dataScript)return JSON.parse(dataScript.textContent);const resultView=document.querySelector('[x-data="resultView()"]');if(resultView&&window.Alpine)return window.Alpine.$data(resultView).resultData;return null;}catch(e){return null;}}function createSummaryStats(data,container){const steps=Object.keys(data).filter(k=>k.startsWith('output_'));let totalRecs=0,criticalIssues=0,highPriority=0;steps.forEach(step=>{const stepData=data[step];if(stepData&&Array.isArray(stepData.recommendations)){totalRecs+=stepData.recommendations.length;stepData.recommendations.forEach(rec=>{if(rec.toLowerCase().includes('critical')||rec.toLowerCase().includes('urgent'))highPriority++;});}if(stepData&&stepData.issues&&Array.isArray(stepData.issues.critical)){criticalIssues+=stepData.issues.critical.length;}});const title=document.createElement('h2');title.className='text-xl font-medium text-teal-600';title.textContent='Key Metrics';container.appendChild(title);const stats=document.createElement('div');stats.className='grid grid-cols-1 md:grid-cols-3 gap-4';stats.innerHTML=`<div class="bg-white p-4 rounded-lg border shadow-sm"><h3 class="font-medium text-gray-800 mb-2">Total Recommendations</h3><p class="text-2xl font-bold text-teal-600">${totalRecs}</p><p class="text-sm text-gray-500 mt-1">${highPriority} high priority</p></div><div class="bg-white p-4 rounded-lg border shadow-sm"><h3 class="font-medium text-gray-800 mb-2">Critical Issues</h3><p class="text-2xl font-bold ${criticalIssues>0?'text-red-600':'text-green-600'}">${criticalIssues}</p><p class="text-sm text-gray-500 mt-1">${criticalIssues>0?'Needs attention':'All clear'}</p></div><div class="bg-white p-4 rounded-lg border shadow-sm"><h3 class="font-medium text-gray-800 mb-2">Steps Analyzed</h3><p class="text-2xl font-bold text-blue-600">${steps.length}</p><p class="text-sm text-gray-500 mt-1">Workflow complete</p></div>`;container.appendChild(stats);}function createCharts(data,container){if(typeof Chart==='undefined')return;const title=document.createElement('h2');title.className='text-xl font-medium text-teal-600 mt-6';title.textContent='Workflow Analysis';container.appendChild(title);const chartContainer=document.createElement('div');chartContainer.className='bg-white p-4 rounded-lg border shadow-sm';chartContainer.style.height='300px';container.appendChild(chartContainer);const canvas=document.createElement('canvas');chartContainer.appendChild(canvas);const steps=Object.keys(data).filter(k=>k.startsWith('output_'));const stepLabels=steps.map(s=>s.replace('output_','').replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase()));const recCounts=steps.map(s=>{const stepData=data[s];return(stepData&&Array.isArray(stepData.recommendations))?stepData.recommendations.length:0;});const issueCounts=steps.map(s=>{const stepData=data[s];let count=0;if(stepData&&stepData.issues){if(Array.isArray(stepData.issues.critical))count+=stepData.issues.critical.length;if(Array.isArray(stepData.issues.warning))count+=stepData.issues.warning.length;}return count;});new Chart(canvas,{type:'bar',data:{labels:stepLabels,datasets:[{label:'Recommendations',data:recCounts,backgroundColor:config.colors.info,borderColor:config.colors.info,borderWidth:1},{label:'Issues',data:issueCounts,backgroundColor:config.colors.danger,borderColor:config.colors.danger,borderWidth:1}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,title:{display:true,text:'Count'}}}}});}function setupFiltering(data){setTimeout(()=>{const tabsNav=document.querySelector('.tabs-nav')||document.querySelector('nav');if(!tabsNav)return;const recTab=Array.from(tabsNav.querySelectorAll('button')).find(b=>b.textContent.trim()==='Recommendations');if(!recTab)return;recTab.addEventListener('click',()=>{setTimeout(()=>{const tabContent=document.querySelector('.tab-content.active');if(!tabContent)return;const title=tabContent.querySelector('h2');if(!title||tabContent.querySelector('.filter-controls'))return;const filters=document.createElement('div');filters.className='filter-controls flex flex-wrap gap-2 mb-4';filters.innerHTML=`<label class="text-sm text-gray-700 mr-1">Category:</label><select class="border rounded-md px-3 py-1 text-sm"><option value="all">All Categories</option><option value="technical">Technical</option><option value="content">Content</option><option value="keyword">Keywords</option><option value="strategy">Strategy</option></select><label class="text-sm text-gray-700 mr-1 ml-4">Priority:</label><select class="border rounded-md px-3 py-1 text-sm"><option value="all">All Priorities</option><option value="high">High Priority</option><option value="medium">Medium Priority</option><option value="low">Low Priority</option></select><button class="ml-2 px-2 py-1 border rounded-md text-xs text-gray-600 hover:bg-gray-100">Clear Filters</button>`;title.parentNode.insertBefore(filters,title.nextSibling);const categorySelect=filters.querySelectorAll('select')[0];const prioritySelect=filters.querySelectorAll('select')[1];const clearButton=filters.querySelector('button');const filterItems=()=>{const cat=categorySelect.value;const priority=prioritySelect.value;const items=tabContent.querySelectorAll('.recommendation-item');items.forEach(item=>{const text=item.textContent||'';const matches=cat==='all'||priority==='all'||(cat==='all'&&(priority==='high'?text.toLowerCase().includes('critical'):true))||(priority==='all'&&text.toLowerCase().includes(cat));item.style.display=matches?'':'none';});};categorySelect.addEventListener('change',filterItems);prioritySelect.addEventListener('change',filterItems);clearButton.addEventListener('click',()=>{categorySelect.value='all';prioritySelect.value='all';filterItems();});},100);});},500);}}());
